var sdf={};!function(e){"use strict";e.fn.serializeObject=function(){var t={},a=this.serializeArray();return e.each(a,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},e.extend(e.expr[":"],{invalid:function(e){var t=document.querySelectorAll(":invalid"),a=!1,s=t.length;if(s)for(var n=0;s>n;n++)if(e===t[n]){a=!0;break}return a}});var t={lines:9,length:13,width:7,radius:26,corners:.8,rotate:30,direction:1,color:"#FFF",speed:.7,trail:76,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},a=new Spinner(t);sdf.preload=function(){var e=document.createElement("image");e.src="/wp-content/plugins/sdf/img/button-gray-tip-transparent.png"},sdf.stateBlur=function(){e("#state").val(e("#state").val().toUpperCase())},sdf.copyPersonalInfo=function(){e(".js-copy-personal-info").prop("checked")?(e("#js-cc-fields input").each(function(t,a){e(a).val(e("#"+e(a).attr("name").substr(3)).val()).removeClass("field-error")}),e("#js-cc-fields .h5-error-msg").each(function(t,a){e(a).hide()}),e("#cc-name").val(e("#first-name").val()+" "+e("#last-name").val()),e("#js-cc-fields").fadeTo("fast",.5,function(){e("#js-cc-fields input").each(function(t,a){e(a).prop("readonly",!0)})})):e("#js-cc-fields").fadeTo("fast",1,function(){e("#js-cc-fields input").each(function(t,a){e(a).prop("readonly",!1)})})},sdf.cc_fields_gray=function(){e(".js-copy-personal-info").prop("checked")&&(e("#js-cc-fields").addClass("faded"),e("#js-cc-fields input").each(function(t,a){e(a).prop("readonly",!0)}))},sdf.futureDate=function(){var t=parseInt(e("#cc-exp-year").val()),a=parseInt(e("#cc-exp-mo").val());30>t&&(t+=2e3);var s=new Date(t,a),n=new Date;n.setHours(0,0,0,0),n.getTime()-s.getTime()>0?e("#cc-exp-mo, #cc-exp-year").addClass("field-custom-error"):e("#cc-exp-mo, #cc-exp-year").removeClass("field-custom-error")},sdf.hearAboutChange=function(){var t=e("#hearabout")[0];e(t.options[t.selectedIndex]).hasClass("js-select-extra")?(e("#js-select-extra-name").html(t.options[t.selectedIndex].value+":"),e("#js-select-extra-input").show()):(e("#hearabout-extra").val(""),e("#js-select-extra-input").hide())},sdf.doSubmit=function(){var t=e("#sdf_form form")[0];if(t.checkValidity()){e("body").append('<div id="loading"></div>'),a.spin(document.getElementById("loading"));var s={number:e("#cc-number").val(),cvc:e("#cc-cvc").val(),exp_month:e("#cc-exp-mo").val(),exp_year:e("#cc-exp-year").val(),name:e("#cc-name").val(),address_zip:e("#cc-zip").val()};Stripe.card.createToken(s,sdf.stripeResponseHandler),e("a#js-form-submit").addClass("disabled").parent().find("img").prop("src","/wp-content/plugins/sdf/img/button-gray-tip-transparent.png")}else e("#sdf_form input:invalid").each(function(t,a){e(a).addClass("field-error")})},sdf.clear_notification=function(t){0===t?e(".alert p").first().remove():(t=t||5e3,setTimeout(function(){e(".alert p").first().fadeTo("fast",0,function(){e(this).animate({height:0},"fast").remove()})},t))},sdf.clear_loading=function(){a.stop(),e("#loading").remove()},sdf.redirect=function(){window.location.href=window.location.protocol+"//"+window.location.hostname+"/donation-confirmation/"},sdf.stripeResponseHandler=function(t,a){var s={};a="undefined"!=typeof a?a:{},a.error?(sdf.clear_notification(0),e(".alert").append('<p class="error">'+a.error.message+"</p>"),document.getElementsByClassName("alert")[0].scrollIntoView(),sdf.clear_loading(),sdf.re_enable()):(e("#stripe-token").val(a.id),s=e("#sdf_form form").serializeObject(),e.each(s,function(e){"cc-"===e.substring(0,3)&&delete s[e]}),e.post(ajaxurl,{action:"sdf_parse",data:s},function(t){sdf.clear_loading(),sdf.clear_notification(0),t=JSON.parse(t),e(".alert").append('<p class="'+t.type+'">'+t.message+"</p>").show(),document.getElementsByClassName("alert")[0].scrollIntoView(),"error"==t.type?sdf.re_enable():setTimeout(sdf.redirect,2500)}))},sdf.re_enable=function(){e("a#js-form-submit").removeClass("disabled").parent().find("img").prop("src","/img/button-dark-tip.png")},sdf.custom_amount_create=function(t){t=t||{};var a=t.target;if(e(a).is("#js-custom-input, #amount-text")||e.contains(a,document.getElementById("js-custom-input")))return!0;sdf.custom_amount_remove();var s=document.createElement("input");s.name=e(a).attr("for"),s.placeholder="Custom amount",s.pattern="^[$]?\\d+([.]\\d{2})?$",s.required=!0,s.type="text",s.id="js-custom-input",s.dataset.h5Errorid="invalid-"+s.name,e(a).html(s).addClass("custom-label-input"),setTimeout(function(){e(s).focus()},0)},sdf.custom_amount_remove=function(){var t=e("#js-custom-input");if(t.length){var a=t.prop("placeholder");t.parent("label").empty().removeClass("custom-label-active custom-label-input").text(a),e("#invalid-"+t.attr("name")).hide()}e("#sdf_form").off("click",".custom-label").on("click",".custom-label",sdf.custom_amount_create)},sdf.custom_amount_blur=function(){var t=e("#js-custom-input"),a=t.val(),s=t.parent("label");if(!a.length){var n=e(sdf.clicked).hasClass("selected"),o=!e(sdf.clicked).is("label.button-look");if(n||o)return!1}if(t.is(":invalid"))return!1;if(a.length){if("$"!==a.substr(0,1)&&(a="$"+a),-1!=a.indexOf(".")){var c=a.split(".");0==c[1].length?c[1]+="00":1==c[1].length&&(c[1]+="0"),a=c[0]+"."+c[1]}t.prop("type","hidden"),e("#amount-text").length?e("#amount-text").text(a):s.append('<span id="amount-text">'+a+"</span>"),s.removeClass("custom-label-input").addClass("custom-label-active")}},sdf.custom_amount_focus=function(){e("#amount-text").remove(),e("#amount-text").length&&e("#amount-text").remove(),e("#js-custom-input").parent("label").addClass("custom-label-input"),e("#js-custom-input").prop("type","text"),setTimeout(function(){e("#js-custom-input").focus()},0)},sdf.radio_change=function(t){var a=!1,t=t||{};"target"in t||(t.target=sdf.clicked);var s=e(t.target).next("label"),n=e(".selected").hasClass("custom-label");if(n){var o=!s.hasClass("custom-label");o&&(a=!0)}a&&sdf.custom_amount_remove(),e(t.target).hasClass("custom-label")&&sdf.custom_amount_create(t),e("label.button-look").removeClass("selected"),e(".amount:checked").next("label").addClass("selected")},sdf.custom_keys=function(e){var t=e.which||e.keyCode;13==t&&sdf.custom_amount_blur()},e(document).mousedown(function(e){sdf.clicked=e.target}),e(document).ready(function(){sdf.cc_fields_gray(),sdf.preload(),e("#sdf_form").on("blur","#js-custom-input",sdf.custom_amount_blur).on("click",".custom-label-active",sdf.custom_amount_focus).on("click",".custom-label",sdf.custom_amount_create).on("keydown","#js-custom-input",sdf.custom_keys),e(".amount").change(sdf.radio_change),e("#hearabout").change(sdf.hearAboutChange),e("#state").blur(sdf.stateBlur),e("#copy-personal-info").click(sdf.copyPersonalInfo),e("a#js-form-submit.disabled").on("click",function(){return!1}),e("#sdf_form form").h5Validate({errorClass:"field-error"}),e("#cc-exp-year").on("focusout",sdf.futureDate),e("#js-form-submit").click(sdf.doSubmit)})}(jQuery);